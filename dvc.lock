schema: '2.0'
stages:
  train:
    cmd: "python src/step_counter/models/dnn_keras/train.py data/steps/train/ models/dnn/base_export
      reports/metrics/train.json --seed=42 --epochs=200 --dropout=0.0 --units=100
      --num-layers=1\n"
    deps:
    - path: data/steps/train/
      hash: md5
      md5: 137744f44fec19f884dd6eced9225b0a.dir
      size: 438586
      nfiles: 8
    params:
      params.yaml:
        seed: 42
    outs:
    - path: models/dnn/base_export
      hash: md5
      md5: bd30a75fba445938751ad7d95d09b468.dir
      size: 596848
      nfiles: 6
    - path: reports/metrics/train.json
      hash: md5
      md5: b85504dd61cd88ea119f169155c22b03
      size: 508
  predict_test:
    cmd: "python src/step_counter/models/dnn_keras/predict.py data/steps/test/ models/dnn/base_export
      reports/predictions/steps/test/ --model-type=keras\n"
    deps:
    - path: data/steps/test/
      hash: md5
      md5: 74bf42681c55e319ec6fb42c98ea9f74.dir
      size: 88024
      nfiles: 2
    - path: models/dnn/base_export/
      hash: md5
      md5: bd30a75fba445938751ad7d95d09b468.dir
      size: 596848
      nfiles: 6
    outs:
    - path: reports/predictions/steps/test/
      hash: md5
      md5: 37f57118cdafe69e5e55ef35331b6a62.dir
      size: 119209
      nfiles: 2
  update-metrics:
    cmd: python update-metrics-table-and-graph.py
    deps:
    - path: reports
      hash: md5
      md5: 9701be830faaaf3e8663c31db2c32cb0.dir
      size: 483108
      nfiles: 18
    - path: update-metrics-table-and-graph.py
      hash: md5
      md5: 3f0edb1fc9ee7c161c5f0e8a58cfbbb7
      size: 1344
  evaluate:
    cmd: "python src/step_counter/evaluate.py data/steps/test/ reports/predictions/steps/test/
      reports/figures/ reports/metrics/\n"
    deps:
    - path: data/steps/test/
      hash: md5
      md5: 74bf42681c55e319ec6fb42c98ea9f74.dir
      size: 88024
      nfiles: 2
    - path: reports/predictions/steps/test/
      hash: md5
      md5: 37f57118cdafe69e5e55ef35331b6a62.dir
      size: 119209
      nfiles: 2
    outs:
    - path: reports/figures/confusion_matrix.csv
      hash: md5
      md5: b508e281d588389cb2b2a82dc9200d00
      size: 24216
    - path: reports/figures/precision_recall_curve.csv
      hash: md5
      md5: 1eb069095b5122dbcba665d1faa8c7bd
      size: 86938
    - path: reports/figures/roc_curve.csv
      hash: md5
      md5: be4d339d80c11efb8de5f170f7ebba92
      size: 10573
    - path: reports/metrics/test.json
      hash: md5
      md5: 39e9bf363dd9f75dd66fbf35c5dcce64
      size: 268
  export_tflite:
    cmd: "python src/step_counter/models/dnn_keras/export_tflite.py models/dnn/base_export/
      models/dnn/tflite/ data/steps/train/\n"
    deps:
    - path: data/steps/train/
      hash: md5
      md5: 137744f44fec19f884dd6eced9225b0a.dir
      size: 438586
      nfiles: 8
    - path: models/dnn/base_export
      hash: md5
      md5: bd30a75fba445938751ad7d95d09b468.dir
      size: 596848
      nfiles: 6
    outs:
    - path: models/dnn/tflite/model.tflite
      hash: md5
      md5: ce3012170077a69674c6f407babc1a23
      size: 17312
    - path: models/dnn/tflite/model_optimized.tflite
      hash: md5
      md5: 3434118604f60129bd147ba8bce048ee
      size: 13808
    - path: models/dnn/tflite/model_quantized.tflite
      hash: md5
      md5: d9f58c32ef2982ba3b5b48f6d24d5687
      size: 17312
  predict_tflite:
    cmd: "python src/step_counter/models/dnn_keras/predict.py data/steps/test/ models/dnn/tflite/model_quantized.tflite
      reports/predictions/steps/test_tflite/ --model-type=tflite\n"
    deps:
    - path: data/steps/test/
      hash: md5
      md5: 74bf42681c55e319ec6fb42c98ea9f74.dir
      size: 88024
      nfiles: 2
    - path: models/dnn/tflite/model_quantized.tflite
      hash: md5
      md5: d9f58c32ef2982ba3b5b48f6d24d5687
      size: 17312
    outs:
    - path: reports/predictions/steps/test_tflite/
      hash: md5
      md5: f0529615c9a0c3e7d46e81f02f708654.dir
      size: 119216
      nfiles: 2
  evaluate_tflite:
    cmd: "python src/step_counter/evaluate.py data/steps/test/ reports/predictions/steps/test_tflite/
      reports/figures_tflite/ reports/metrics_tflite/\n"
    deps:
    - path: data/steps/test/
      hash: md5
      md5: 74bf42681c55e319ec6fb42c98ea9f74.dir
      size: 88024
      nfiles: 2
    - path: reports/predictions/steps/test_tflite/
      hash: md5
      md5: f0529615c9a0c3e7d46e81f02f708654.dir
      size: 119216
      nfiles: 2
    outs:
    - path: reports/figures_tflite/confusion_matrix.csv
      hash: md5
      md5: b508e281d588389cb2b2a82dc9200d00
      size: 24216
    - path: reports/figures_tflite/precision_recall_curve.csv
      hash: md5
      md5: 632ecfd9488971e98f430d7ae78a613e
      size: 86949
    - path: reports/figures_tflite/roc_curve.csv
      hash: md5
      md5: 84f59d49778a17f8d01808a47a95134d
      size: 10564
    - path: reports/metrics_tflite/test.json
      hash: md5
      md5: 39e9bf363dd9f75dd66fbf35c5dcce64
      size: 268
  convert_tflite_to_c:
    cmd: xxd -i models/dnn/tflite/model_quantized.tflite models/dnn/tflite/model_quantized.h
      && clang-format -i models/dnn/tflite/model_quantized.h && cp models/dnn/tflite/model_quantized.h
      arduino/Accelerometer/Model.h
    deps:
    - path: models/dnn/tflite/model_quantized.tflite
      hash: md5
      md5: d9f58c32ef2982ba3b5b48f6d24d5687
      size: 17312
    outs:
    - path: arduino/Accelerometer/Model.h
      hash: md5
      md5: 7604a185c8a3c325f349e79a0caf1444
      size: 107649
    - path: models/dnn/tflite/model_quantized.h
      hash: md5
      md5: 7604a185c8a3c325f349e79a0caf1444
      size: 107649
