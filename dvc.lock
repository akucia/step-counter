schema: '2.0'
stages:
  train:
    cmd: "python src/step_counter/models/dnn_keras/train.py data/steps/train/ models/dnn/base_export
      reports/metrics/train.json --seed=42\n"
    deps:
    - path: data/steps/train/
      hash: md5
      md5: 137744f44fec19f884dd6eced9225b0a.dir
      size: 438586
      nfiles: 8
    params:
      params.yaml:
        seed: 42
    outs:
    - path: models/dnn/base_export
      hash: md5
      md5: 794527ef5cc7f2b41b07710be0d08fd1.dir
      size: 609115
      nfiles: 6
    - path: reports/metrics/train.json
      hash: md5
      md5: 21f0dfbb725730357320b69de9222922
      size: 505
  predict_test:
    cmd: "python src/step_counter/models/dnn_keras/predict.py data/steps/test/ models/dnn/base_export
      reports/predictions/steps/test/ --model-type=keras\n"
    deps:
    - path: data/steps/test/
      hash: md5
      md5: 74bf42681c55e319ec6fb42c98ea9f74.dir
      size: 88024
      nfiles: 2
    - path: models/dnn/base_export/
      hash: md5
      md5: 794527ef5cc7f2b41b07710be0d08fd1.dir
      size: 609115
      nfiles: 6
    outs:
    - path: reports/predictions/steps/test/
      hash: md5
      md5: 1cc4747b3ef2b58d4b43cf44ef04b30a.dir
      size: 118941
      nfiles: 2
  update-metrics:
    cmd: python update-metrics-table-and-graph.py
    deps:
    - path: reports
      hash: md5
      md5: 9c04e52d78528f11d4ab09454cde89f0.dir
      size: 485041
      nfiles: 18
    - path: update-metrics-table-and-graph.py
      hash: md5
      md5: 3f0edb1fc9ee7c161c5f0e8a58cfbbb7
      size: 1344
  evaluate:
    cmd: "python src/step_counter/evaluate.py data/steps/test/ reports/predictions/steps/test/
      reports/figures/ reports/metrics/\n"
    deps:
    - path: data/steps/test/
      hash: md5
      md5: 74bf42681c55e319ec6fb42c98ea9f74.dir
      size: 88024
      nfiles: 2
    - path: reports/predictions/steps/test/
      hash: md5
      md5: 1cc4747b3ef2b58d4b43cf44ef04b30a.dir
      size: 118941
      nfiles: 2
    outs:
    - path: reports/figures/confusion_matrix.csv
      hash: md5
      md5: 1b5299491181a5b32e3ffe00c2fdc67a
      size: 24174
    - path: reports/figures/precision_recall_curve.csv
      hash: md5
      md5: 0133c03c18ed7c800b019aaa4a134735
      size: 87535
    - path: reports/figures/roc_curve.csv
      hash: md5
      md5: 651820737e987bb7376936e6fb739575
      size: 11276
    - path: reports/metrics/test.json
      hash: md5
      md5: 32cabfb53f4f7fade11dfedbbd3bbfdb
      size: 266
  export_tflite:
    cmd: "python src/step_counter/models/dnn_keras/export_tflite.py models/dnn/base_export/
      models/dnn/tflite/ data/steps/train/\n"
    deps:
    - path: data/steps/train/
      hash: md5
      md5: 137744f44fec19f884dd6eced9225b0a.dir
      size: 438586
      nfiles: 8
    - path: models/dnn/base_export
      hash: md5
      md5: 794527ef5cc7f2b41b07710be0d08fd1.dir
      size: 609115
      nfiles: 6
    outs:
    - path: models/dnn/tflite/model.tflite
      hash: md5
      md5: 9e79dc3da80000fc57225444065544c4
      size: 17312
    - path: models/dnn/tflite/model_optimized.tflite
      hash: md5
      md5: 1048776bf72bcbefe6ee653e8fc18ebe
      size: 13808
    - path: models/dnn/tflite/model_quantized.tflite
      hash: md5
      md5: 043151c1fc623d5d139f63e6e631b6bb
      size: 17312
  predict_tflite:
    cmd: "python src/step_counter/models/dnn_keras/predict.py data/steps/test/ models/dnn/tflite/model_quantized.tflite
      reports/predictions/steps/test_tflite/ --model-type=tflite\n"
    deps:
    - path: data/steps/test/
      hash: md5
      md5: 74bf42681c55e319ec6fb42c98ea9f74.dir
      size: 88024
      nfiles: 2
    - path: models/dnn/tflite/model_quantized.tflite
      hash: md5
      md5: 043151c1fc623d5d139f63e6e631b6bb
      size: 17312
    outs:
    - path: reports/predictions/steps/test_tflite/
      hash: md5
      md5: 7ab6c5541c247cd92e471e7d4b2bbb15.dir
      size: 118930
      nfiles: 2
  evaluate_tflite:
    cmd: "python src/step_counter/evaluate.py data/steps/test/ reports/predictions/steps/test_tflite/
      reports/figures_tflite/ reports/metrics_tflite/\n"
    deps:
    - path: data/steps/test/
      hash: md5
      md5: 74bf42681c55e319ec6fb42c98ea9f74.dir
      size: 88024
      nfiles: 2
    - path: reports/predictions/steps/test_tflite/
      hash: md5
      md5: 7ab6c5541c247cd92e471e7d4b2bbb15.dir
      size: 118930
      nfiles: 2
    outs:
    - path: reports/figures_tflite/confusion_matrix.csv
      hash: md5
      md5: 1b5299491181a5b32e3ffe00c2fdc67a
      size: 24174
    - path: reports/figures_tflite/precision_recall_curve.csv
      hash: md5
      md5: 5e785e69f919faef868c46e85455742e
      size: 87519
    - path: reports/figures_tflite/roc_curve.csv
      hash: md5
      md5: eea81c08536a1f062805052f3616f155
      size: 11272
    - path: reports/metrics_tflite/test.json
      hash: md5
      md5: 32cabfb53f4f7fade11dfedbbd3bbfdb
      size: 266
  convert_tflite_to_c:
    cmd: xxd -i models/dnn/tflite/model_quantized.tflite > models/dnn/tflite/model_quantized.h
    deps:
    - path: models/dnn/tflite/model_quantized.tflite
      hash: md5
      md5: 043151c1fc623d5d139f63e6e631b6bb
      size: 17312
    outs:
    - path: models/dnn/tflite/model_quantized.h
      hash: md5
      md5: 1f8dd9bee5d32a1032a73b487b4ae26a
      size: 106888
