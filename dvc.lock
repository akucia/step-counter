schema: '2.0'
stages:
  train:
    cmd: "python src/step_counter/models/dnn_keras/train.py data/steps/train/ models/dnn/base_export
      reports/metrics/train.json --seed=42 --epochs=200 --dropout=0.0 --units=100
      --num-layers=1\n"
    deps:
    - path: data/steps/train/
      hash: md5
      md5: 4e2ef4dbe8f9c0e00b03006e4ca1bf30.dir
      size: 616237
      nfiles: 13
    params:
      params.yaml:
        seed: 42
    outs:
    - path: models/dnn/base_export
      hash: md5
      md5: 56bb9c6162e12a4854fc33ed5b45a6f2.dir
      size: 597183
      nfiles: 6
    - path: reports/metrics/train.json
      hash: md5
      md5: 5476020db45f56b2b41556883d693f13
      size: 491
  predict_test:
    cmd: "python src/step_counter/models/dnn_keras/predict.py data/steps/test/ models/dnn/base_export
      reports/predictions/steps/test/ --model-type=keras\n"
    deps:
    - path: data/steps/test/
      hash: md5
      md5: 74bf42681c55e319ec6fb42c98ea9f74.dir
      size: 88024
      nfiles: 2
    - path: models/dnn/base_export/
      hash: md5
      md5: 56bb9c6162e12a4854fc33ed5b45a6f2.dir
      size: 597183
      nfiles: 6
    outs:
    - path: reports/predictions/steps/test/
      hash: md5
      md5: 3aed635f348efa11aa02fb6a0d44515d.dir
      size: 118921
      nfiles: 2
  update-metrics:
    cmd: python update-metrics-table-and-graph.py
    deps:
    - path: reports
      hash: md5
      md5: 449ab842f5abcb70178456726dda2115.dir
      size: 479324
      nfiles: 18
    - path: update-metrics-table-and-graph.py
      hash: md5
      md5: 3f0edb1fc9ee7c161c5f0e8a58cfbbb7
      size: 1344
  evaluate:
    cmd: "python src/step_counter/evaluate.py data/steps/test/ reports/predictions/steps/test/
      reports/figures/ reports/metrics/\n"
    deps:
    - path: data/steps/test/
      hash: md5
      md5: 74bf42681c55e319ec6fb42c98ea9f74.dir
      size: 88024
      nfiles: 2
    - path: reports/predictions/steps/test/
      hash: md5
      md5: 3aed635f348efa11aa02fb6a0d44515d.dir
      size: 118921
      nfiles: 2
    outs:
    - path: reports/figures/confusion_matrix.csv
      hash: md5
      md5: 8cfc11e861e83bd50d6f567b99f4a104
      size: 24042
    - path: reports/figures/precision_recall_curve.csv
      hash: md5
      md5: 4d1eebe70cf43fd0168c10341be70922
      size: 86144
    - path: reports/figures/roc_curve.csv
      hash: md5
      md5: 3be8bc1b02c560ef1209207ee099ceb7
      size: 9963
    - path: reports/metrics/test.json
      hash: md5
      md5: 4bbdcf6d31f93380d7873e2f95ddf3de
      size: 268
  export_tflite:
    cmd: "python src/step_counter/models/dnn_keras/export_tflite.py models/dnn/base_export/
      models/dnn/tflite/ data/steps/train/\n"
    deps:
    - path: data/steps/train/
      hash: md5
      md5: 4e2ef4dbe8f9c0e00b03006e4ca1bf30.dir
      size: 616237
      nfiles: 13
    - path: models/dnn/base_export
      hash: md5
      md5: 56bb9c6162e12a4854fc33ed5b45a6f2.dir
      size: 597183
      nfiles: 6
    outs:
    - path: models/dnn/tflite/model.tflite
      hash: md5
      md5: bd1196d0ee1c953f842dbeec84d6ab17
      size: 17312
    - path: models/dnn/tflite/model_optimized.tflite
      hash: md5
      md5: 68ae80a25c83e15ac8ffc9078044446b
      size: 13808
    - path: models/dnn/tflite/model_quantized.tflite
      hash: md5
      md5: 150c4a52f14e9c389e5c361bebb96583
      size: 17312
  predict_tflite:
    cmd: "python src/step_counter/models/dnn_keras/predict.py data/steps/test/ models/dnn/tflite/model_quantized.tflite
      reports/predictions/steps/test_tflite/ --model-type=tflite\n"
    deps:
    - path: data/steps/test/
      hash: md5
      md5: 74bf42681c55e319ec6fb42c98ea9f74.dir
      size: 88024
      nfiles: 2
    - path: models/dnn/tflite/model_quantized.tflite
      hash: md5
      md5: 150c4a52f14e9c389e5c361bebb96583
      size: 17312
    outs:
    - path: reports/predictions/steps/test_tflite/
      hash: md5
      md5: ae951bf5bbaedde26d5dfcd5c102131a.dir
      size: 118934
      nfiles: 2
  evaluate_tflite:
    cmd: "python src/step_counter/evaluate.py data/steps/test/ reports/predictions/steps/test_tflite/
      reports/figures_tflite/ reports/metrics_tflite/\n"
    deps:
    - path: data/steps/test/
      hash: md5
      md5: 74bf42681c55e319ec6fb42c98ea9f74.dir
      size: 88024
      nfiles: 2
    - path: reports/predictions/steps/test_tflite/
      hash: md5
      md5: ae951bf5bbaedde26d5dfcd5c102131a.dir
      size: 118934
      nfiles: 2
    outs:
    - path: reports/figures_tflite/confusion_matrix.csv
      hash: md5
      md5: 8cfc11e861e83bd50d6f567b99f4a104
      size: 24042
    - path: reports/figures_tflite/precision_recall_curve.csv
      hash: md5
      md5: db0367eeee3d56f7b4e15ea844bb434f
      size: 86114
    - path: reports/figures_tflite/roc_curve.csv
      hash: md5
      md5: 2006a7f93febf1d400df72c80b487bf9
      size: 9955
    - path: reports/metrics_tflite/test.json
      hash: md5
      md5: 9033f2950c4de660467f247e1a839181
      size: 267
  convert_tflite_to_c:
    cmd: xxd -i models/dnn/tflite/model_quantized.tflite models/dnn/tflite/model_quantized.h
      && clang-format -i models/dnn/tflite/model_quantized.h && cp models/dnn/tflite/model_quantized.h
      arduino/Accelerometer/Model.h
    deps:
    - path: models/dnn/tflite/model_quantized.tflite
      hash: md5
      md5: 150c4a52f14e9c389e5c361bebb96583
      size: 17312
    outs:
    - path: arduino/Accelerometer/Model.h
      hash: md5
      md5: 9250c211014f4102f00b766e79907c11
      size: 107649
    - path: models/dnn/tflite/model_quantized.h
      hash: md5
      md5: 9250c211014f4102f00b766e79907c11
      size: 107649
